name: Update and Upload Data

# on:
#   schedule:
#     - cron: '0 0 1 * *' # 毎月1日に実行

on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
      environment:
        description: 'Environment name'
        required: true

jobs:
  update_and_upload:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
    - name: Install dependencies
      run: |
        pip install pandas numpy
    - name: Generate data.json
      run: python generate_data.py
    - name: Install Wrangler CLI
      run: npm install -g @cloudflare/wrangler
    - name: Login to Cloudflare
      run: wrangler login
    - name: Upload data.json to KV
      run: wrangler kv:key put --binding=MY_KV_STORE "data.json" ./data.json --path
      env:
        CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
        CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
